<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAVIYA PAPER HUB | Professional Downloader</title>
    <link href="https://fonts.googleapis.com/css2?family=Abhaya+Libre:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #bd00ff;
            --success: #2ecc71;
            --bg: #0f0c29;
            --glass: rgba(255, 255, 255, 0.08);
        }

        body { font-family: 'Poppins', sans-serif; background: #0f0c29; color: white; margin: 0; }

        /* Loader */
        #loader-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: 0.8s;
        }

        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }

        /* Main Container */
        .container { max-width: 1100px; margin: 0 auto; padding: 50px 20px; }

        .logo { font-size: 3rem; text-align: center; font-weight: 800; margin-bottom: 40px; }
        .logo span { color: var(--primary); }

        /* Search Box */
        .search-area { max-width: 600px; margin: 0 auto 50px; background: var(--glass); border-radius: 50px; padding: 10px; display: flex; border: 1px solid rgba(255,255,255,0.1); }
        .search-area input { flex: 1; background: transparent; border: none; padding: 10px 20px; color: white; outline: none; font-size: 1rem; }
        .search-area button { background: var(--primary); border: none; border-radius: 50px; width: 50px; height: 50px; cursor: pointer; transition: 0.3s; }

        /* Results Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; }
        .card { background: var(--glass); border-radius: 20px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; cursor: pointer; text-align: center; }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .card img { width: 100%; border-radius: 15px; margin-bottom: 15px; height: 150px; object-fit: cover; }
        .card h3 { font-size: 0.95rem; line-height: 1.4; height: 2.8em; overflow: hidden; }

        /* Modal & Download Section */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 1000; }
        .modal-content { background: #16213e; max-width: 500px; margin: 100px auto; padding: 40px; border-radius: 30px; border: 1px solid var(--primary); position: relative; text-align: center; }
        .close { position: absolute; top: 20px; right: 25px; font-size: 1.5rem; cursor: pointer; color: #666; }

        .dl-option {
            background: rgba(255,255,255,0.05);
            padding: 20px; border-radius: 15px; margin-top: 20px;
            border: 1px dashed rgba(255,255,255,0.2);
            transition: 0.3s;
        }

        /* Download Button Animation */
        .download-btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            background: var(--primary); color: #000; padding: 15px 30px; border-radius: 12px;
            text-decoration: none; font-weight: 700; width: 100%; margin-top: 10px;
            transition: 0.3s; position: relative; overflow: hidden;
        }

        .download-btn.loading { background: #34495e; color: #fff; cursor: wait; }
        .download-btn.loading i { animation: spin 1s linear infinite; }
        
        .status-msg { margin-top: 15px; font-family: 'Abhaya Libre', serif; color: var(--primary); font-size: 1.1rem; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader-wrapper">
        <div class="spinner"></div>
        <h1 style="letter-spacing: 5px;">RAVIYA HUB</h1>
        <p style="font-family: 'Abhaya Libre';">‡∂∏‡∂Ø‡∂ö‡∑ä ‡∂ª‡∑ê‡∂≥‡∑ì ‡∑É‡∑í‡∂ß‡∑í‡∂±‡∑ä‡∂±...</p>
    </div>

    <div class="container" id="main-ui" style="display:none;">
        <div class="logo">RAVIYA <span>HUB</span></div>

        <div class="search-area">
            <input type="text" id="q" placeholder="‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂± (‡∂ã‡∂Ø‡∑è: Bio 2022)..." onkeypress="if(event.key==='Enter') search()">
            <button onclick="search()"><i class="fas fa-search"></i></button>
        </div>

        <h2 style="font-family: 'Abhaya Libre'; margin-bottom: 30px;">üî• ‡∂¢‡∂±‡∂¥‡∑ä‚Äç‡∂ª‡∑í‡∂∫ ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∂¥‡∂≠‡∑ä‚Äç‡∂ª</h2>
        <div id="grid" class="grid"></div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="m-title" style="font-size: 1.2rem; margin-bottom: 20px;">Paper Name</h2>
            <div id="m-body"></div>
            <div id="status-text" class="status-msg"></div>
        </div>
    </div>

    <script>
        // UI Control
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader-wrapper').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader-wrapper').style.display = 'none';
                    document.getElementById('main-ui').style.display = 'block';
                    loadItems();
                }, 500);
            }, 2000);
        };

        async function loadItems() {
            const res = await fetch('/api/recent');
            render(await res.json());
        }

        async function search() {
            const q = document.getElementById('q').value;
            if(!q) return;
            document.getElementById('grid').innerHTML = '<div class="spinner"></div>';
            const res = await fetch(`/api/search?q=${encodeURIComponent(q)}`);
            render(await res.json());
        }

        function render(data) {
            const grid = document.getElementById('grid');
            grid.innerHTML = data.map(p => `
                <div class="card" onclick="openDetails('${p.url}')">
                    <img src="${p.image || 'https://via.placeholder.com/200x150/111/fff?text=Paper'}">
                    <h3>${p.title}</h3>
                </div>
            `).join('');
        }

        async function openDetails(url) {
            const modal = document.getElementById('modal');
            const body = document.getElementById('m-body');
            const title = document.getElementById('m-title');
            
            modal.style.display = 'block';
            title.innerText = "‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª ‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑í‡∂∏‡∑í‡∂±‡∑ä...";
            body.innerHTML = '<div class="spinner" style="margin: 20px auto;"></div>';

            const res = await fetch(`/api/details?url=${encodeURIComponent(url)}`);
            const data = await res.json();

            title.innerText = data.title;
            body.innerHTML = data.downloadLinks.map(link => `
                <div class="dl-option">
                    <p style="font-size: 0.8rem; opacity: 0.6; margin-bottom: 10px;">Document (${link.type.toUpperCase()})</p>
                    <a href="javascript:void(0)" class="download-btn" id="btn-${Math.random().toString(36).substr(2, 9)}" 
                       onclick="startDownload('${link.url}', '${data.title}', this)">
                        <i class="fas fa-cloud-download-alt"></i> ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (Download)
                    </a>
                </div>
            `).join('');
        }

        async function startDownload(url, name, btn) {
            if(btn.classList.contains('loading')) return;

            // 1. UI Update (Loading start)
            btn.classList.add('loading');
            btn.innerHTML = '<i class="fas fa-spinner"></i> ‡∑É‡∑ñ‡∂Ø‡∑è‡∂±‡∂∏‡∑ä ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä...';
            const statusText = document.getElementById('status-text');
            statusText.innerText = "‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∑Ä‡∑í‡∂∫. ‡∂∏‡∂Ø‡∂ö‡∑ä ‡∂ª‡∑ê‡∂≥‡∑ì ‡∑É‡∑í‡∂ß‡∑í‡∂±‡∑ä‡∂±...";

            try {
                // 2. ‡∑É‡∂ª‡∑ä‡∑Ä‡∂ª‡∑ä ‡∂ë‡∂ö ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂©‡∑Ä‡∑î‡∂±‡∑ä‡∂Ω‡∑ù‡∂©‡∑ä ‡∂ë‡∂ö ‡∑É‡∑í‡∂Ø‡∑ä‡∂∞ ‡∑Ä‡∑ô‡∂±‡∑Ä‡∑è
                const downloadUrl = `/api/download?url=${encodeURIComponent(url)}&name=${encodeURIComponent(name)}`;
                
                // ‡∂á‡∂≠‡∑ä‡∂≠‡∂ß‡∂∏ ‡∑Ü‡∂∫‡∑í‡∂Ω‡∑ä ‡∂ë‡∂ö ‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂± trigger ‡∂ë‡∂ö ‡∂Ø‡∑ô‡∂±‡∑Ä‡∑è
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.setAttribute('download', name + '.pdf');
                document.body.appendChild(link);
                link.click();
                link.remove();

                // 3. UI Update (Success)
                setTimeout(() => {
                    btn.classList.remove('loading');
                    btn.style.background = 'var(--success)';
                    btn.innerHTML = '<i class="fas fa-check-circle"></i> ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í!';
                    statusText.innerText = "‡∂î‡∂∂‡∑ö ‡∂ã‡∂¥‡∑è‡∂Ç‡∂ú‡∂∫‡∂ß ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä.";
                }, 3000);

            } catch (err) {
                btn.classList.remove('loading');
                btn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑í';
                statusText.innerText = "‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂∫. ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.";
            }
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('status-text').innerText = "";
        }
    </script>
</body>
          </html>
